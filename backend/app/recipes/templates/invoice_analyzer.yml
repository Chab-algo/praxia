slug: invoice-analyzer
name: Invoice Analyzer
description: "Extracts structured data from invoices and detects anomalies"
category: finance
version: "1.0.0"
icon: file-text

estimated_cost_per_run: 0.001

input_schema:
  type: object
  required:
    - invoice_text
  properties:
    invoice_text:
      type: string
      description: "The extracted text content of the invoice"
    expected_vendor:
      type: string
      description: "Expected vendor name for validation"
    max_amount:
      type: number
      description: "Maximum expected amount for anomaly detection"

output_schema:
  type: object
  properties:
    vendor:
      type: string
    invoice_number:
      type: string
    date:
      type: string
    total_amount:
      type: number
    currency:
      type: string
    line_items:
      type: array
    anomalies:
      type: array

steps:
  - id: extract_data
    name: "Extract Invoice Data"
    type: llm_call
    complexity: extract
    system_prompt: |
      Extract structured data from this invoice. Respond with JSON only.
      Format: {"vendor": "...", "invoice_number": "...", "date": "YYYY-MM-DD", "total_amount": 0.00, "currency": "EUR", "line_items": [{"description": "...", "quantity": 1, "unit_price": 0.00, "total": 0.00}], "tax_amount": 0.00, "subtotal": 0.00}
    user_prompt: "Invoice content:\n{{invoice_text}}"
    max_tokens: 400
    temperature: 0.1
    response_format: json_object
    cacheable: true

  - id: validate
    name: "Validate & Detect Anomalies"
    type: llm_call
    complexity: classify
    system_prompt: |
      Validate this invoice data and detect anomalies. Check for:
      - Math errors (line items vs total)
      - Missing required fields
      - Unusual amounts
      Respond with JSON: {"is_valid": true|false, "anomalies": ["description of each issue"], "confidence": 0-100}
    user_prompt: |
      Extracted invoice data: {{steps.extract_data.output}}
      Expected vendor: {{expected_vendor}}
      Max expected amount: {{max_amount}}
    max_tokens: 200
    temperature: 0.1
    response_format: json_object
    cacheable: false

  - id: format_output
    name: "Format Output"
    type: transform
    mapping:
      vendor: "{{steps.extract_data.output.vendor}}"
      invoice_number: "{{steps.extract_data.output.invoice_number}}"
      date: "{{steps.extract_data.output.date}}"
      total_amount: "{{steps.extract_data.output.total_amount}}"
      currency: "{{steps.extract_data.output.currency}}"
      line_items: "{{steps.extract_data.output.line_items}}"
      anomalies: "{{steps.validate.output.anomalies}}"

roi_metrics:
  time_saved: "10h/week"
  cost_saved: "Based on avg 8min per manual invoice processing"
  use_case: "Automated invoice data extraction and validation"
